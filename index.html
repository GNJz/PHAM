<!DOCTYPE html>
<html lang="ko">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-XXXXXXX');
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PHAM</title>
  <link rel="stylesheet" href="style.css" />

  <style>
    /* 추가: 전역 불릿 제거 (점 숨김) */
    ul, li { list-style: none; margin: 0; padding: 0; }
    *::mark{ content: ""; }

    /* ===== 기본 스타일 (네가 주신 틀 유지) ===== */
    :root { --menu-width: 250px; } /* 메뉴 폭 변수 (JS가 실제 폭으로 갱신) */

    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #fff;
        color: #000;
        overflow-x: hidden;
        transition: transform 0.3s ease;
    }
    .menu-btn {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1000;
        background: none;
        border: none;
        color: #000;
        font-size: 2em;
        cursor: pointer;
        transition: left 0.3s ease;
    }
    .side-menu {
        position: fixed;
        top: 0;
        left: 0;
        width: 250px;
        height: 100vh;
        background-color: rgba(255, 255, 255, 0.9);
        padding: 60px 20px 20px;
        box-sizing: border-box;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        z-index: 2000; /* 메뉴가 항상 위로 오도록 살짝 상향 */
        border-right: 1px solid #ccc;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        /* 스크롤바 UI 감추기 */
        scrollbar-width: none; /* Firefox */
    }
    .side-menu::-webkit-scrollbar{ width: 0; height: 0; }
    .side-menu.active {
        transform: translateX(0);
    }

    .logo-center {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%); /* 기본: 정확히 정중앙 */
        z-index: 50;
        transition: transform 0.3s ease, opacity 0.3s ease;
        pointer-events: none;
        will-change: transform;
    }
    .logo-center img {
        width: 100%;
        max-width: 500px;
        height: auto;
    }

    /* 메뉴가 열리면 로고를 '남은 화면의 정중앙'으로 살짝 오른쪽 이동 */
    body.menu-open .logo-center{
        transform: translate(calc(-50% + var(--menu-width) / 2), -50%);
    }

    #pageWrap {
        position: relative;
        display: none; /* 초기 로드 잔상 방지: 홈에서만 로고 보이게 */
        min-height: 100vh;
        transition: transform 0.3s ease;
    }
    .content {
        display: none;
        padding: 40px;
        box-sizing: border-box;
        min-height: 100vh;
    }
    .content.active {
        display: block;
    }
    .submenu {
      list-style: none;
      padding-left: 15px;
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-in-out;
      margin: 0;
    }
    .submenu.show {
      max-height: 9999px; /* 12개 이상도 충분히 보이도록 확대 */
    }
    .submenu-toggle, .menu-content a, .menu-content button.menu-link {
      color: #000;
      text-decoration: none;
      display: block;
      padding: 13px 0;
      background: transparent !important;
      background-image: none !important;
      border: none;
      text-align: left;
      width: 100%;
    }

    /* 버튼/링크 클릭 시 회색 배경 제거 및 기본 버튼 스타일 초기화 */
    .submenu-toggle {
      -webkit-appearance: none !important;
      appearance: none;
      background-color: transparent;
      border-radius: 0;
      box-shadow: none;
      -webkit-tap-highlight-color: transparent;
    }
    .submenu-toggle::-webkit-focus-inner{ border:0; padding:0; }
    .menu-content button.menu-link{
      -webkit-appearance: none !important;
      appearance: none;
      background-color: transparent;
      border-radius: 0;
      box-shadow: none;
      -webkit-tap-highlight-color: transparent;
      cursor: pointer;
    }
    .submenu-toggle:hover,
    .submenu-toggle:focus,
    .submenu-toggle:focus-visible,
    .submenu-toggle:active {
      background: transparent !important;
      background-color: transparent !important;
      background-image: none !important;
      outline: none;
      box-shadow: none;
    }
    .menu-content a:hover,
    .menu-content a:focus,
    .menu-content a:focus-visible,
    .menu-content a:active {
      background: transparent !important;
      background-color: transparent !important;
      background-image: none !important;
      outline: none;
      box-shadow: none;
      -webkit-tap-highlight-color: transparent;
    }
    .menu-content button.menu-link:hover,
    .menu-content button.menu-link:focus,
    .menu-content button.menu-link:focus-visible,
    .menu-content button.menu-link:active{
      background: transparent !important;
      background-color: transparent !important;
      background-image: none !important;
      outline: none;
      box-shadow: none;
      -webkit-tap-highlight-color: transparent;
    }

    /* 메뉴 오픈 시 전체 페이지 스크롤 잠금 */
    body.menu-open{ overflow: hidden; height: 100dvh; }

    /* 모바일에서 서브메뉴 잘림 방지(12번까지 보이게 여유 확보) */
    @media (max-width: 800px){
      .side-menu.active .submenu.show{ max-height: 9999px; }
      .side-menu{ height: 100dvh; padding-bottom: 120px; }
    }
  </style>
</head>
<body>
  <button class="menu-btn" id="menuBtn" aria-controls="sideMenu" aria-expanded="false" aria-label="메뉴 열기">☰</button>

  <nav class="side-menu" id="sideMenu" aria-label="사이드 내비게이션" style="display:none;">
    <div class="menu-content" id="menuContent">
      <a href="#home" data-section="home">Home</a>

      <button class="submenu-toggle" aria-expanded="false">memo</button>
      <ul class="submenu">
        <li><a href="#memo_1" data-section="memo_1">1. 이과 모드</a></li>
        <li><a href="#memo_2" data-section="memo_2">2. 문과 모드</a></li>
        <li><a href="#memo_3" data-section="memo_3">3. 예체능 모드</a></li>
        <li><a href="#memo_4" data-section="memo_4">4. 잡담 모드</a></li>
      </ul>

      <button class="submenu-toggle" aria-expanded="false">KAO : K-pop Art Online</button>
      <ul class="submenu has-gap">
        <li><a href="#KAO_2" data-section="iDea">iDea (세계관)</a></li>
        <li><a href="#KAO_3" data-section="SaaS">SaaS (구조)</a></li>
      </ul>

      <a href="#prologue" data-section="prologue" class="spacer-top">프롤로그 prologue</a>
      <a href="#part1" data-section="part1">파트 1 : 의식의 변화</a>
      <a href="#mixtape" data-section="mixtape">mixtape : Runway</a>

      <button class="submenu-toggle" aria-expanded="false">파트 2 : ep - Extended play</button>
      <ul class="submenu">
        <li><a href="#part2_memo" data-section="part2_memo">1. memo - memory</a></li>
        <li><a href="#part2_memory" data-section="part2_memory">2. memory - melody</a></li>
        <li><a href="#part2_rhythm" data-section="part2_rhythm">3. rhythm & flow</a></li>
        <li><a href="#part2_mixtape2" data-section="part2_mixtape2">4. mixtape^2 : Threads</a></li>
        <li><a href="#part2_lost" data-section="part2_lost">5. Lost</a></li>
        <li><a href="#part2_vega" data-section="part2_vega">6. Vega</a></li>
        <li><a href="#part2" data-section="part2">파트 2 전체</a></li>
      </ul>

      <a href="#maze" data-section="maze">DLC : 지옥의 대미궁</a>
      <a href="#rocket" data-section="rocket">single : Rocke+ Spirit</a>

      <button class="submenu-toggle" aria-expanded="false">파트 3 : warpSpace</button>
      <ul class="submenu">
        <li><a href="#part3_qquarts" data-section="part3_qquarts">1. Qquarts co.</a></li>
        <li><a href="#part3_quarkka" data-section="part3_quarkka">2. Quarkka.Rivet</a></li>
        <li><a href="#part3_cto" data-section="part3_cto">3. CTO . Qlode</a></li>
        <li><a href="#part3_4" data-section="part3_4">4. </a></li>
        <li><a href="#part3_5" data-section="part3_5">5. </a></li>
        <li><a href="#part3_6" data-section="part3_6">6. </a></li>
        <li><a href="#part3_7" data-section="part3_7">7. </a></li>
        <li><a href="#part3_8" data-section="part3_8">8. </a></li>
        <li><a href="#part3_9" data-section="part3_9">9. </a></li>
        <li><a href="#part3_10" data-section="part3_10">10. </a></li>
        <li><a href="#part3_11" data-section="part3_11">11. </a></li>
        <li><a href="#part3_12" data-section="part3_12">12. </a></li>
      </ul>
    </div>
  </nav>

  <div class="logo-center">
     <img src="images/pham_logo.jpg" alt="PHAM" />
  </div>

  <main id="pageWrap">
    <div class="content" id="mainContent"></div>
    <section class="content" id="home"></section>
    <section class="content" id="memo_1">이과 메모 초기 텍스트</section>
    <section class="content" id="memo_2">문과 메모 초기 텍스트</section>
    <section class="content" id="memo_3">예체능 메모 초기 텍스트</section>
    <section class="content" id="memo_4">
      <h2>잡담 모드</h2>
      <div id="chatFeed">불러오는 중...</div>
    </section>
    <section class="content" id="prologue">프롤로그</section>
    <section class="content" id="part1">파트 1 내용</section>
    <section class="content" id="mixtape">믹스테이프</section>
    <section class="content" id="maze">지옥의 대미궁</section>
    <section class="content" id="rocket">로켓 스피릿</section>
    <section class="content" id="part2_memo"><h2>1. memo - memory</h2><p>memo - memory 내용</p></section>
    <section class="content" id="part2_memory"><h2>2. memory - melody</h2><p>memory - melody 내용</p></section>
    <section class="content" id="part2_rhythm"><h2>3. rhythm & flow</h2><p>rhythm & flow 내용</p></section>
    <section class="content" id="part2_mixtape2"><h2>4. mixtape^2 : Threads</h2><p>mixtape^2 : Threads 내용</p></section>
    <section class="content" id="part2_lost"><h2>5. Lost</h2><p>Lost 내용</p></section>
    <section class="content" id="part2_vega"><h2>6. Vega</h2><p>Vega 내용</p></section>
    <section class="content" id="part2">
      <h2>파트 2 : ep - Extended play</h2>
      <div class="part2-content">
        <h3>1. memo - memory</h3>
        <p>memo - memory 내용</p>
        
        <h3>2. memory - melody</h3>
        <p>memory - melody 내용</p>
        
        <h3>3. rhythm & flow</h3>
        <p>rhythm & flow 내용</p>
        
        <h3>4. mixtape^2 : Threads</h3>
        <p>mixtape^2 : Threads 내용</p>
        
        <h3>5. Lost</h3>
        <p>Lost 내용</p>
        
        <h3>6. Vega</h3>
        <p>Vega 내용</p>
      </div>
    </section>
    <section class="content" id="KAO">KAO : K-pop Art Online </section>
    <section class="content" id="part3_qquarts"><h2>1. Qquarts co.</h2><p>Qquarts co.</p></section>
    <section class="content" id="part3_quarkka"><h2>2. Quarkka.Rivet</h2><p>quarkka.Rivet</p></section>
    <section class="content" id="part3_cto"><h2>3. CTO . Qlode</h2><p>CTO . Qlode </p></section>
    <section class="content" id="part3_4"><h2>4. </h2><p></p></section>
    <section class="content" id="part3_5"><h2>5. </h2><p></p></section>
    <section class="content" id="part3_6"><h2>6. </h2><p></p></section>
    <section class="content" id="part3_7"><h2>7. </h2><p></p></section>
    <section class="content" id="part3_8"><h2>8. </h2><p></p></section>
    <section class="content" id="part3_9"><h2>9. </h2><p></p></section>
    <section class="content" id="part3_10"><h2>10. </h2><p></p></section>
    <section class="content" id="part3_11"><h2>11. </h2><p></p></section>
    <section class="content" id="part3_12"><h2>12. </h2><p></p></section>
      <h2>파트 3 : warpSpace</h2>
      <div class="part3-content">
        <h3>1. Qquarts co.</h3>
        <p>Qquarts co. 내용</p>
        
        <h3>2. Quarkka.Rivet</h3>
        <p>Quarkka.Rivet 내용</p>
        
        <h3>3. CTO . Qlode</h3>
        <p>CTO . Qlode 내용</p>
        
        <h3>4-12. 추가 섹션들</h3>
        <p>추가 섹션들의 내용이 여기에 들어갑니다.</p>
      </div>
    </section>
  </main>

  <script>
    // 피드 로더: 에러 시 조용히 무시
    async function loadFeed(){
      try{
        const res = await fetch('/api/feed', { cache: 'no-store' });
        if(!res.ok) return;
        const posts = await res.json();
        if(!Array.isArray(posts) || posts.length === 0) return;
        const container = document.createElement('div');
        container.style.padding = '20px';
        posts.forEach(p => {
          const div = document.createElement('div');
          const safeTitle = (p.title||'').toString();
          const safeBody = (p.body||'').toString();
          div.innerHTML = `<h3>${safeTitle}</h3><p>${safeBody}</p><hr>`;
          container.appendChild(div);
        });
        document.body.prepend(container);
      }catch(_){ /* ignore */ }
    }
    document.addEventListener('DOMContentLoaded', () => {
      const body        = document.body;
      const sideMenu    = document.getElementById('sideMenu');
      const menuBtn     = document.getElementById('menuBtn');
      const menuContent = document.getElementById('menuContent');
      const logoCenter  = document.querySelector('.logo-center');
      const pageWrap    = document.getElementById('pageWrap');

      // 모든 section에 .content 보강(중복도 OK)
      document.querySelectorAll('section').forEach(section => {
          section.classList.add('content');
      });

      function setMenuWidthVar(){
        const w = sideMenu.getBoundingClientRect().width || 250;
        document.documentElement.style.setProperty('--menu-width', w + 'px');
      }

      function updateMenuState() {
        body.classList.toggle('menu-open', sideMenu.classList.contains('active'));
        setMenuWidthVar();
      }

      // 햄버거 버튼 토글
      menuBtn.addEventListener('click', () => {
        sideMenu.classList.toggle('active');
        const isOpen = sideMenu.classList.contains('active');
        menuBtn.setAttribute('aria-expanded', String(isOpen));
        sideMenu.style.display = isOpen ? 'block' : 'none';
        // 열릴 때는 서브메뉴를 기본 접힘 상태로 유지
        document.querySelectorAll('.submenu').forEach(ul => {
          ul.classList.remove('show');
        });
        updateMenuState();
      });

      // 창 크기 바뀌면 메뉴 폭 변수 재계산(열려있을 때)
      window.addEventListener('resize', () => {
        if (sideMenu.classList.contains('active')) setMenuWidthVar();
      });

      // 서브메뉴 토글
      document.querySelectorAll('.submenu-toggle').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const sub = btn.nextElementSibling;
          if (sub && sub.classList.contains('submenu')) {
            sub.classList.toggle('show');
            const expanded = btn.getAttribute('aria-expanded') === 'true';
            btn.setAttribute('aria-expanded', String(!expanded));
          }
          // 클릭 후 포커스 제거하여 잔상 방지
          setTimeout(() => btn.blur(), 0);
        });
      });

      // 섹션 전환
      function showSection(id) {
        const sections = document.querySelectorAll('.content');
        sections.forEach(s => s.classList.remove('active'));

        const el = document.getElementById(id);
        if (el) el.classList.add('active');

        // 홈만 로고 표시
        if (id === 'home' || !id) {
          logoCenter.style.display = 'block';
          menuBtn.style.display = 'block';
          if (pageWrap) pageWrap.style.display = 'none';
        } else {
          logoCenter.style.display = 'none';
          menuBtn.style.display = 'block';
          if (pageWrap) pageWrap.style.display = '';
        }

        sideMenu.classList.remove('active');
        menuBtn.setAttribute('aria-expanded', 'false');
        sideMenu.style.display = 'none';
        updateMenuState();
      }

      // 메뉴 클릭(위임)
      menuContent.addEventListener('click', e => {
        const link = e.target.closest('[data-section]');
        if (!link) return;
        e.preventDefault();
        showSection(link.getAttribute('data-section'));
      });

      // 상태바 URL 노출 방지: 메뉴 내 a를 버튼으로 대체
      Array.from(menuContent.querySelectorAll('a[data-section]')).forEach(a => {
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'menu-link';
        btn.setAttribute('data-section', a.getAttribute('data-section') || '');
        btn.innerHTML = a.innerHTML;
        a.replaceWith(btn);
      });

      // 대문(홈)에서 로고 클릭 시 메뉴 열기
      logoCenter.addEventListener('click', () => {
        const onHome = document.getElementById('home')?.classList.contains('active');
        if (!onHome) return;
        sideMenu.classList.add('active');
        sideMenu.style.display = 'block';
        menuBtn.style.display = 'block';
        menuBtn.setAttribute('aria-expanded', 'true');
        updateMenuState();
      });

      // 초기 상태: 항상 홈으로 시작 (URL 해시 무시)
      setMenuWidthVar();
      try { history.replaceState(null, '', location.pathname + location.search); } catch (_) {}
      showSection('home');
      // 필요 시 피드 로드 (홈 상단에 표시). 실패해도 무시
      loadFeed();
    });
  </script>
  <script src="js/posts.js"></script>
  <script src="js/chat.js"></script>
</body>
</html>